clc; clear all; close all;

u = 5; % Напряжение, подведенное к электродвигателю (В)
R = 5; % Активное сопротивление обмотки якоря (Ом)
L = 0.00067; % Индуктивность обмотки якоря (Гн)
k_omega = 0.01; % Коэффициент пропорциональности ЭДС
k_m = 10; % Коэффициент пропорциональности электромагнитного момента
J = 0.005; % Момент инерции вентилятора (кг*м^2)
k_c = 0.1; % Коэффициент момента сопротивления
h = 0.0001; % Шаг по времени (с)
N = 30000; % Количество шагов

% Инициализация массивов
t = zeros(1, N+1); i = zeros(1, N+1); omega = zeros(1, N+1); 

% Начальные условия
i(1) = 0; omega(1) = 0; t(1) = 0;

for j = 1:N
    E = k_omega * omega(j); % ЭДС самоиндукции
    Me = k_m * i(j); % Электромагнитный момент двигателя
    Mc = k_c * omega(j); % Момент сопротивления вентилятора
    
    di_dt = (u - E - i(j) * R) / L;
    d_omega_dt = (Me - Mc) / J;
    
    i(j+1) = i(j) + h * di_dt;
    omega(j+1) = omega(j) + h * d_omega_dt;
    t(j+1) = t(j) + h;
end

figure;
subplot(2, 1, 1);
plot(t, i);
xlabel('Время (с)'); ylabel('Ток (А)'); title('Ток в обмотке якоря');

subplot(2, 1, 2);
plot(t, omega * 30 / pi); % Преобразование угловой скорости в обороты в минуту
xlabel('Время (с)'); ylabel('Скорость вращения (об/мин)'); title('Скорость вращения вентилятора');
grid on;
